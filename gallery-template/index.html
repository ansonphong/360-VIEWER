<!DOCTYPE html>
<html lang="en" style="background: #000;">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
		<style>
			html, body { background: #000; margin: 0; overflow: hidden; }
			#container { background: #000; }
			canvas { background: #000; }
		</style>

		<!-- TODO: Add your Google Analytics tracking code here -->

		<title>My 360 Gallery</title>
		<link rel="stylesheet" href="360-viewer/css/styles.css" />
		<link rel="stylesheet" href="360-viewer/css/phong-360-ui.css" />
		<link rel="stylesheet" href="https://unpkg.com/@phosphor-icons/web@2.1.1/src/regular/style.css">

		<!-- TODO: Update these meta tags for your gallery -->
		<meta name="description" content="My 360 panoramic image gallery" />
		<meta property="og:title" content="My 360 Gallery" />
		<meta property="og:description" content="Explore my 360 panoramic image gallery" />
		<!-- <meta property="og:image" content="https://yourdomain.com/assets/og-image.jpg" /> -->
		<!-- <meta property="og:url" content="https://yourdomain.com" /> -->
		<meta property="og:type" content="website" />
	</head>
	<body style="background: #000;">
		<div id="container" style="background: #000;"></div>
		<div id="info-panel">
			<!-- TODO: Add your logo: <img src="assets/logo.png" class="phong-logo" /> -->
			<h1 id="imageTitle" class="title">Loading...</h1>
			<h2 id="imageFormat" class="subtitle">360Â° Viewer</h2>
		</div>
		<div id="drag-drop-overlay"><div class="icon">DROP</div><div class="message">EQUIRECTANGULAR IMAGE</div></div>
		<div id="loading-overlay"><div class="spinner"></div></div>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
		<script src="360-viewer/core/phong-360-viewer-core.js"></script>
		<script src="360-viewer/extensions/phong-360-multi-image.js"></script>
		<script src="360-viewer/extensions/phong-360-library-ui.js"></script>

		<script>
			const LIBRARY_URL = new URLSearchParams(window.location.search).get('library') || 'library/library.json';
			let viewer;
			window.addEventListener('DOMContentLoaded', function() {
				try {
					viewer = new Phong360LibraryUI({ containerId: 'container', libraryUrl: LIBRARY_URL, baseUrl: 'library/', theme: 'auto' });
					viewer.callbacks.onImageLoad = function(data, res) {
						var t = document.getElementById('imageTitle'), f = document.getElementById('imageFormat');
						if (t) t.textContent = data.title || 'Unknown';
						if (f && res) f.textContent = res.label + ' (' + res.width + '\u00D7' + res.height + ')';
					};
					if (viewer.core) document.addEventListener('keydown', function(e) {
						if ((e.key==='p'||e.key==='P') && e.target.tagName!=='INPUT' && e.target.tagName!=='TEXTAREA')
							viewer.core.switchProjection(viewer.core.projectionType===0?1:0);
					});
					window.phong360 = { viewer };
					// Drag and drop
					document.addEventListener('dragenter', function(e) { e.preventDefault(); document.getElementById('drag-drop-overlay').style.display='flex'; });
					document.addEventListener('dragover', function(e) { e.preventDefault(); e.dataTransfer.dropEffect='copy'; });
					document.addEventListener('dragleave', function(e) { e.preventDefault(); if(!e.relatedTarget||e.relatedTarget.nodeName==='HTML') document.getElementById('drag-drop-overlay').style.display='none'; });
					document.addEventListener('drop', function(e) {
						e.preventDefault(); document.getElementById('drag-drop-overlay').style.display='none';
						var file=e.dataTransfer.files[0];
						if(file&&(file.type==='image/jpeg'||file.type==='image/png')){
							var url=URL.createObjectURL(file), img=new Image();
							img.onload=function(){ document.getElementById('imageTitle').textContent=file.name.replace(/\.[^.]+$/,'');
								document.getElementById('imageFormat').textContent=img.naturalWidth+'x'+img.naturalHeight;
								if(viewer&&viewer.core) viewer.core.loadImage(url,img.naturalWidth,img.naturalHeight); };
							img.src=url;
						}
					});
				} catch(err) { console.error('Error:', err); }
			});
			document.addEventListener('wheel', function(e) { if(e.ctrlKey) e.preventDefault(); }, { passive: false });
		</script>
	</body>
</html>
